@using Web_Apax.Models;
@{
    ViewBag.Title = "ChiTietHocSinh";
    Layout = null;
}
@model TH_HOSOKHACHHANG
<input type="hidden" value="@Model.A_HOSOKHACHHANG" id="A_HOSOKHACHHANG" />
<input type="hidden" value="@ViewBag.NguoiDung" id="NguoiDung" />
<input type="hidden" value="@ViewBag.ChucVuTK" id="ChucVuTK" />
<input type="hidden" value="@ViewBag.ChucVuKhac" id="ChucVuKhac" />
<div class="container tabs-wrap">
    <ul class="nav nav-tabs" role="tablist">
        <li role="presentation" class="active">
            <a href="#tths" aria-controls="input" role="tab" data-toggle="tab" aria-expanded="true">THÔNG TIN HỌC SINH</a>
        </li>
        <li id="tab_cskh">
            <a href="#ls_cskh" aria-controls="output" role="tab" data-toggle="tab" aria-expanded="false">LS CSKH</a>
        </li>
        <li id="tab_dkh">
            <a href="#ls_dkh" aria-controls="output" role="tab" data-toggle="tab" aria-expanded="false">LS ĐĂNG KÝ HỌC</a>
        </li>
        <li id="tab_xl">
            <a href="#ls_xl" aria-controls="output" role="tab" data-toggle="tab" aria-expanded="false">LS XẾP LỚP</a>
        </li>
        <li id="tab_bl">
            <a href="#ls_bl" aria-controls="output" role="tab" data-toggle="tab" aria-expanded="false">LS BẢO LƯU</a>
        </li>
        <li id="tab_cp">
            <a href="#ls_cp" aria-controls="output" role="tab" data-toggle="tab" aria-expanded="false">LS CHUYỂN PHÍ</a>
        </li>
        <li id="tab_cl">
            <a href="#ls_cl" aria-controls="output" role="tab" data-toggle="tab" aria-expanded="false">LS CHUYỂN LỚP</a>
        </li>
        <li id="tab_td">
            <a href="#ls_td" aria-controls="output" role="tab" data-toggle="tab" aria-expanded="false">LS TẠM DỪNG</a>
        </li>
        <li id="tab_tp">
            <a href="#ls_tp" aria-controls="output" role="tab" data-toggle="tab" aria-expanded="false">LS THU PHÍ</a>
        </li>
    </ul>

    <div class="tab-content">
        <div role="tabpanel" class="tab-pane active" id="tths">
            <form class="form-horizontal">
                <!--Menu-->
                <div class="margin text-right" style="padding-bottom:0px">
                    <div class="btn-group"><button type="button" id="btn_Luu" class="btn btn-block btn-danger" onclick="Save()">Lưu</button></div>
                </div>
                <!--/Menu-->
                <div class="box-body" style="padding-top:0px">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="col-sm-12 control-label text-bold" style="text-align:left">THÔNG TIN HỌC SINH</label>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-4 control-label">Mã học sinh</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" id="MAKH" readonly value="@Model.MAKH">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-4 control-label" id="lbl_TENKHACHHANG">Tên học sinh<span>(*)</span></label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" id="TENKHACHHANG" value="@Model.TENKHACHHANG">
                                <span class="error" id="lbl_ten" hidden>This field is required</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-4 control-label">Tỉnh thành</label>
                            <div class="col-sm-8">
                                <div id="TinhThanh"></div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-4 control-label">Loại học sinh</label>
                            <div class="col-sm-8">
                                <div id="ID_LOAIHOSOKH">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="col-sm-12 control-label text-bold" style="text-align:left">&ensp; </label>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-4 control-label">Mã EFFECT</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" id="MaEffect" readonly value="@Model.C_makh">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-4 control-label">Ngày sinh<span>(*)</span></label>
                            <div class="col-sm-8">
                                <div id="NgaySinh"></div>
                                <span class="error" id="lbl_ngaysinh" hidden>This field is required</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-4 control-label">Quận huyện</label>
                            <div class="col-sm-8">
                                <div id="QuanHuyen"></div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-4 control-label">Nickname</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" id="TENTIENGANH" value="@Model.TENTIENGANH">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="col-sm-12 control-label text-bold" style="text-align:left">&ensp; </label>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-4 control-label">Mã LMS</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" id="MaLMS" readonly value="@Model.ma_lms">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-4 control-label">Giới tính</label>
                            <div class="col-sm-8">
                                <div id="ID_GIOITINH">
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-4 control-label">Địa chỉ<span>(*)</span></label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" id="DIACHI" value="@Model.DIACHI">
                                <span class="error" id="lbl_diachi" hidden>This field is required</span>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /.box-body -->

                <div class="box-body" style="padding-top:0px">
                    <div class="form-group">
                        <label class="col-sm-12 control-label text-bold" style="text-align:left">THÔNG TIN PHỤ HUYNH - GIA ĐÌNH</label>
                    </div>
                    <div class="row">
                        <div class="col-sm-4">
                            <div class="form-group">
                                <label class="col-sm-4 control-label" style="padding-left:0px">Tên phụ huynh 1<span>(*)</span></label>
                                <div class="col-sm-8">
                                    <input type="text" class="form-control" id="TENBO" value="@Model.TENBO">
                                    <span class="error" id="lbl_tenbo" hidden>This field is required</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-4">
                            <div class="form-group">
                                <label class="col-sm-4 control-label">Di động<span>(*)</span></label>
                                <div class="col-sm-8">
                                    <input type="text" class="form-control" id="DD_BO" value="@Model.DD_BO" maxlength="11">
                                    <span class="error" id="lbl_ddbo" hidden>This field is required</span>
                                    <script>
                            $(function () {
                                $('#DD_BO').keydown(function (e) {
                                    if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 110, 190]) !== -1 ||
                                        (e.keyCode === 65 && (e.ctrlKey === true || e.metaKey === true)) || (e.keyCode >= 35 && e.keyCode <= 40)) {
                                        return;
                                    }
                                    if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
                                        e.preventDefault();
                                    }
                                });
                                $('#DD_ME').keydown(function (e) {
                                    if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 110, 190]) !== -1 ||
                                        (e.keyCode === 65 && (e.ctrlKey === true || e.metaKey === true)) || (e.keyCode >= 35 && e.keyCode <= 40)) {
                                        return;
                                    }
                                    if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
                                        e.preventDefault();
                                    }
                                });
                            })
                                    </script>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-4">
                            <div class="form-group">
                                <label class="col-sm-4 control-label">Email</label>
                                <div class="col-sm-8">
                                    <input type="text" class="form-control" id="EmailBo" value="@Model.EMAIL_BO">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-4">
                            <div class="form-group">
                                <label class="col-sm-4 control-label" style="padding-left:0px">Tên phụ huynh 2</label>
                                <div class="col-sm-8">
                                    <input type="text" class="form-control" id="TENME" value="@Model.TENME">
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-4">
                            <div class="form-group">
                                <label class="col-sm-4 control-label">Di động</label>
                                <div class="col-sm-8">
                                    <input type="text" class="form-control" id="DD_ME" value="@Model.DD_ME" maxlength="11">
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-4">
                            <div class="form-group">
                                <label class="col-sm-4 control-label">Email</label>
                                <div class="col-sm-8">
                                    <input type="text" class="form-control" id="EmailMe" value="@Model.EMAIL_ME">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-4">
                            <div class="form-group">
                                <label class="col-sm-4 control-label" style="padding-left:0px">Số CMTND</label>
                                <div class="col-sm-8">
                                    <input type="text" class="form-control" id="SOCMTND" value="@Model.SOCMTND">
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-4">
                            <div class="form-group">
                                <label class="col-sm-4 control-label" style="padding:7px 0px">Mã anh em học cùng</label>
                                <div class="col-sm-8">
                                    <input type="text" class="form-control" id="MA_CH" value="@Model.MA_CH">
                                    <script>
                        $('#MA_CH').keyup(function (e) {
                            if (e.which == 13) {
                                if ($('#MA_CH').val() == $('#MAKH').val()) {
                                    DevExpress.ui.notify('Mã anh em học cùng trùng với mã học sinh! Vui lòng kiểm tra lại.', 'warning', 2000);
                                    $('#TEN_CH').val('');
                                    $('#MA_CH').val('');
                                } else {
                                    if ($('#MA_CH').val() == '') {
                                        $('#TEN_CH').val('');
                                    } else {
                                        $.ajax({
                                            url: '@Url.Action("GetTenAnhEmHocCung", "HoSoHocVien")?ma=' + $('#MA_CH').val(),
                                            success: function (result) {
                                                if (result != '') {
                                                    $('#TEN_CH').val(result);
                                                }
                                                else {
                                                    DevExpress.ui.notify('Mã anh em học cùng không tồn tại trong hệ thống! Vui lòng kiểm tra lại.', 'warning', 2000);
                                                }
                                            },
                                            error: function (a, b, c) {
                                                DevExpress.ui.notify('Error ' + a.status + ': ' + a.statusText, 'error', 2000);
                                            }
                                        })
                                    }
                                }
                            }
                        })
                                    </script>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-4">
                            <div class="form-group">
                                <label class="col-sm-4 control-label" style="padding:7px 0px">Tên anh em học cùng</label>
                                <div class="col-sm-8">
                                    <input type="text" class="form-control" id="TEN_CH" readonly value="@ViewBag.TENCH">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /.box-body -->
                <div class="box-body" style="padding-top:0px">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="col-sm-12 control-label text-bold" style="text-align:left">THÔNG TIN TRUNG TÂM</label>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-4 control-label">Trung tâm</label>
                            <div class="col-sm-8">
                                <div id="TrungTam"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="col-sm-12 control-label text-bold" style="text-align:left">&ensp; </label>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-4 control-label">EC</label>
                            <div class="col-sm-8">
                                <div id="SalePhuTrach"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="col-sm-12 control-label text-bold" style="text-align:left">&ensp; </label>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-4 control-label">CM</label>
                            <div class="col-sm-8">
                                <div id="CMPhuTrach"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
        <div role="tabpanel" class="tab-pane" id="ls_cskh">
            <div class="box box-danger">
                <div class="row">
                    <div class="col-md-12">
                        <div id="LS_GiaoDich"></div>
                    </div>
                </div>
            </div>
        </div>
        <div role="tabpanel" class="tab-pane" id="ls_dkh">
            <div class="box box-danger">
                <div class="row">
                    <div class="col-md-12">
                        <div id="LS_DangKy"></div>
                    </div>
                </div>
            </div>
        </div>
        <div role="tabpanel" class="tab-pane" id="ls_xl">
            <div class="box box-danger">
                <div class="row">
                    <div class="col-md-12">
                        <div id="LS_XepLop"></div>
                    </div>
                </div>
            </div>
        </div>
        <div role="tabpanel" class="tab-pane" id="ls_bl">
            <div class="box box-danger">
                <div class="row">
                    <div class="col-md-12">
                        <div id="LS_BaoLuu"></div>
                    </div>
                </div>
            </div>
        </div>
        <div role="tabpanel" class="tab-pane" id="ls_cp">
            <div class="box box-danger">
                <div class="row">
                    <div class="col-md-12">
                        <div id="LS_ChuyenPhi"></div>
                    </div>
                </div>
            </div>
        </div>
        <div role="tabpanel" class="tab-pane" id="ls_cl">
            <div class="box box-danger">
                <div class="row">
                    <div class="col-md-12">
                        <div id="LS_ChuyenLop"></div>
                    </div>
                </div>
            </div>
        </div>
        <div role="tabpanel" class="tab-pane" id="ls_td">
            <div class="box box-danger">
                <div class="row">
                    <div class="col-md-12">
                        <div id="LS_TamDung"></div>
                    </div>
                </div>
            </div>
        </div>
        <div role="tabpanel" class="tab-pane" id="ls_tp">
            <div class="box box-danger">
                <div class="row">
                    <div class="col-md-12">
                        <div id="LS_ThuHocPhi"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row" hidden>
    <div class="col-md-12">
        <div id="gridDanhSachHocVien"></div>
    </div>
</div>
<style>
    .error{
	display: none;
	margin-left: 10px;
    color:red;
}	
</style>
<script>
    function Load_LSGiaoDich(hv)
    {
        $.ajax({
            url: '@Url.Action("LoadHocSinhGiaoDich", "GiaoDich")',
            type: 'GET',
            data: { HocVien: hv },
            contentType: 'application/json',
            success: function (rs) {
                var dataGrid = $("#LS_GiaoDich").dxDataGrid({
                    dataSource: rs,
                    allowColumnReordering: true,
                    allowColumnResizing: true,
                    columnAutoWidth: true,
                    columnFixing: {
                        enabled: true
                    },
                    paging: {
                        pageSize: 10
                    },
                    pager: {
                        showPageSizeSelector: true,
                        allowedPageSizes: [5, 10, 20],
                        showInfo: true
                    },
                    selection: {
                        mode: 'single'
                    },
                    showColumnLines: true,
                    showRowLines: true,
                    filterRow: {
                        visible: true,
                        applyFilter: "auto"
                    },
                    columns: [
                          {
                              caption: "Ngày làm việc",
                              dataField: "NGAYGIAODICH",
                              datatype: "date",
                              alignment: "right",
                          }, {
                              dataField: "NGUOIGIAODICH",
                              caption: "Người thực hiện",
                          },  {
                              caption: "Phương thức",
                              dataField: "PHUONGTHUC",
                          },
                          {
                              dataField: "NOIDUNG_GIAODICH",
                              caption: "Nội dung công việc",
                          },
                    ],
                }).dxDataGrid('instance');
            },
            error: function (a, b, c) {
                DevExpress.ui.notify('Error ' + a.status + ': ' + a.statusText, 'error', 2000);
            }

        });
    }
    function Load_LSThuHocPhi(hv) {
        $.ajax({
            url: '@Url.Action("LichSuThuPhi", "ThuPhi")',
            type: 'GET',
            data: { KhachHang: hv, HopDong: 0, loai: 1 },
            contentType: 'application/json',
            success: function (rs) {
                var dataGrid = $("#LS_ThuHocPhi").dxDataGrid({
                    dataSource: rs,
                    allowColumnReordering: true,
                    allowColumnResizing: true,
                    columnAutoWidth: true,
                    columnFixing: {
                        enabled: true
                    },
                    paging: {
                        pageSize: 10
                    },
                    pager: {
                        showPageSizeSelector: true,
                        allowedPageSizes: [5, 10, 20],
                        showInfo: true
                    },
                    selection: {
                        mode: 'single'
                    },
                    showColumnLines: true,
                    showRowLines: true,
                    filterRow: {
                        visible: true,
                        applyFilter: "auto"
                    },
                    columns: [
                          {
                              dataField: "NGAYTHUTIEN",
                              caption: "Ngày thu tiền",
                              alignment: "right",
                          }, {
                              dataField: "NguoiThuTien",
                              caption: "Người thu tiền",
                          },
                           {
                               dataField: "TONGTIEN_HD",
                               caption: "Tổng tiền đăng ký",
                               format: "fixedPoint",
                               alignment: "right",
                           },
                          {
                              dataField: "SOTIENTHU",
                              caption: "Tổng tiền đã thu",
                              format: "fixedPoint",
                              alignment: "right",
                          }, {
                              dataField: "SOTIENCONLAI",
                              caption: "Công nợ còn lại",
                              format: "fixedPoint",
                              alignment: "right",
                          }, {
                              dataField: "TENLOAIPHIEUTHU",
                              caption: "Hình thức thu",
                          },
                          {
                              dataField: "TENLOAITHUTIEN",
                              caption: "Loại thu tiền",
                          }, {
                              dataField: "",
                              caption: "Tái phí",
                          },
                    ],
                }).dxDataGrid('instance');
            },
            error: function (a, b, c) {
                DevExpress.ui.notify('Error ' + a.status + ': ' + a.statusText, 'error', 2000);
            }
        });
    }
    function Load_LSBaoLuu(hocvien) {
        $.ajax({
            url: '@Url.Action("LoadDanhSachHocSinhDaBaoLuu", "DangKyBaoLuu")',
            type: 'GET',
            data: { HocVien: hocvien, LopHoc: 0 },
            contentType: 'application/json',
            success: function (rs) {
                var dataGrid = $("#LS_BaoLuu").dxDataGrid({
                    dataSource: rs,
                    allowColumnReordering: true,
                    allowColumnResizing: true,
                    columnAutoWidth: true,
                    columnFixing: {
                        enabled: true
                    },
                    paging: {
                        pageSize: 10
                    },
                    pager: {
                        showPageSizeSelector: true,
                        allowedPageSizes: [5, 10, 20],
                        showInfo: true
                    },
                    selection: {
                        mode: 'single'
                    },
                    showColumnLines: true,
                    showRowLines: true,
                    filterRow: {
                        visible: true,
                        applyFilter: "auto"
                    },
                    columns: [{
                        caption: "Ngày",
                        dataField: "",
                        alignment: "right",
                    }, {
                        dataField: "NguoiBaoLuu",
                        caption: "Người thực hiện",
                    }, {
                        caption: "Ngày bảo lưu",
                        dataField: "NGAYBAOLUU",
                        alignment: "right",
                    }, {
                              dataField: "SOBUOIBAOLUU",
                              caption: "Số buổi bảo lưu",
                          }, {
                              dataField: "HINHTHUC",
                              caption: "Hình thức",
                          }, {
                              dataField: "GHICHU",
                              caption: "Lý do",
                          },
                    ],

                }).dxDataGrid('instance');
            },
            error: function (a, b, c) {
                DevExpress.ui.notify('Error ' + a.status + ': ' + a.statusText, 'error', 2000);
            }

        });
    }
    function Load_LSDangKy(hocvien) {
        $.ajax({
            url: '@Url.Action("LoadLichSuDangKy", "DangKyLop")',
            type: 'GET',
            data: { HocVien: hocvien },
            contentType: 'application/json',
            success: function (rs) {
                var dataGrid = $("#LS_DangKy").dxDataGrid({
                    dataSource: rs,
                    allowColumnReordering: true,
                    allowColumnResizing: true,
                    columnAutoWidth: true,
                    columnFixing: {
                        enabled: true
                    },
                    paging: {
                        pageSize: 10
                    },
                    pager: {
                        showPageSizeSelector: true,
                        allowedPageSizes: [5, 10, 20],
                        showInfo: true
                    },
                    selection: {
                        mode: 'single'
                    },
                    showColumnLines: true,
                    showRowLines: true,
                    filterRow: {
                        visible: true,
                        applyFilter: "auto"
                    },
                    columns: [{
                        caption: "Ngày",
                        dataField: "NgayThucHien",
                        alignment: "right",
                    }, {
                        dataField: "NguoiThucHien",
                        caption: "Người thực hiện",
                    }, {
                        caption: "Chương trình",
                        dataField: "ChuongTrinh",
                    }, {
                        dataField: "LOAIKH",
                        caption: "Loại khách hàng",
                    }, {
                        dataField: "TENGOIPHI",
                        caption: "Gói phí",
                    }, {
                        dataField: "SoBuoiHoc",
                        caption: "Số buổi",
                    }, {
                        dataField: "DONGIA",
                        caption: "Giá trị gói",
                        format: "fixedPoint",
                        alignment: "right",
                    }, {
                        dataField: "CHIETKHAU",
                        caption: "Chiết khấu",
                    }, {
                        dataField: "THANHTIEN",
                        caption: "Thành tiền",
                        format: "fixedPoint",
                        alignment: "right",
                    }, {
                        dataField: "NgayDuKienHoc",
                        caption: "Ngày học dự kiến",
                        alignment: "right",
                    }],
                }).dxDataGrid('instance');
            },
            error: function (a, b, c) {
                DevExpress.ui.notify('Error ' + a.status + ': ' + a.statusText, 'error', 2000);
            }
        });
    }
    function Load_XepLop(hocvien) {
        $.ajax({
            url: '@Url.Action("LoadLichSuXepLop", "HoSoHocVien")',
            type: 'GET',
            data: { HocVien: hocvien },
            contentType: 'application/json',
            success: function (rs) {
                var dataGrid = $("#LS_XepLop").dxDataGrid({
                    dataSource: rs,
                    allowColumnReordering: true,
                    allowColumnResizing: true,
                    columnAutoWidth: true,
                    columnFixing: {
                        enabled: true
                    },
                    paging: {
                        pageSize: 10
                    },
                    pager: {
                        showPageSizeSelector: true,
                        allowedPageSizes: [5, 10, 20],
                        showInfo: true
                    },
                    selection: {
                        mode: 'single'
                    },
                    showColumnLines: true,
                    showRowLines: true,
                    filterRow: {
                        visible: true,
                        applyFilter: "auto"
                    },
                    columns: [{
                        caption: "Ngày",
                        dataField: "NgayThucHien",
                        alignment: "right",
                    }, {
                        dataField: "NguoiThucHien",
                        caption: "Người thực hiện",
                    }, {
                        caption: "Chương trình",
                        dataField: "ChuongTrinh",
                    }, {
                        dataField: "TenLop",
                        caption: "Lớp",
                    }, {
                        dataField: "NGAYBATDAU",
                        caption: "Ngày bắt đầu học",
                        alignment: "right",
                    }, {
                        dataField: "NGAYKETTHUC",
                        caption: "Ngày kết thúc",
                        alignment: "right",
                    }, {
                        dataField: "TRANGTHAIHOC",
                        caption: "Trạng thái học",
                    }],
                }).dxDataGrid('instance');
            },
            error: function (a, b, c) {
                DevExpress.ui.notify('Error ' + a.status + ': ' + a.statusText, 'error', 2000);
            }
        });
    }
    function Load_ChuyenPhi(hocvien) {
        $.ajax({
            url: '@Url.Action("LoadLichSuChuyenPhi", "DangKyChuyenPhi")',
            type: 'GET',
            data: { HocVien: hocvien },
            contentType: 'application/json',
            success: function (rs) {
                var dataGrid = $("#LS_ChuyenPhi").dxDataGrid({
                    dataSource: rs,
                    allowColumnReordering: true,
                    allowColumnResizing: true,
                    columnAutoWidth: true,
                    columnFixing: {
                        enabled: true
                    },
                    paging: {
                        pageSize: 10
                    },
                    pager: {
                        showPageSizeSelector: true,
                        allowedPageSizes: [5, 10, 20],
                        showInfo: true
                    },
                    selection: {
                        mode: 'single'
                    },
                    showColumnLines: true,
                    showRowLines: true,
                    filterRow: {
                        visible: true,
                        applyFilter: "auto"
                    },
                    columns: [{
                        caption: "Ngày",
                        dataField: "NGAYCHUYEN",
                        alignment: "right",
                    }, {
                        dataField: "NGUOITHUCHIEN",
                        caption: "Người thực hiện",
                    }, {
                        caption: "Học sinh chuyển",
                        dataField: "TENHOCVIENCHUYEN",
                    }, {
                        dataField: "MALMSCHUYEN",
                        caption: "Mã LMS",
                    }, {
                        dataField: "TENHOCVIENNHAN",
                        caption: "Học sinh nhận",
                    }, {
                        dataField: "MALMSNHAN",
                        caption: "Mã LMS",
                    }, {
                        dataField: "NGAYCHUYEN",
                        caption: "Ngày chuyển",
                        alignment: "right",
                    }, {
                        dataField: "SOBUOICHUYEN",
                        caption: "Số buổi chuyển",
                    }, {
                        dataField: "TIENCHUYEN",
                        caption: "Số tiền chuyển",
                        format: "fixedPoint",
                        alignment: "right",
                    }],
                }).dxDataGrid('instance');
            },
            error: function (a, b, c) {
                DevExpress.ui.notify('Error ' + a.status + ': ' + a.statusText, 'error', 2000);
            }
        });
    }
    function Load_ChuyenLop(hocvien) {
        $.ajax({
            url: '@Url.Action("LoadLichSuChuyenLop", "DangKyChuyenLop")',
            type: 'GET',
            data: { HocVien: hocvien },
            contentType: 'application/json',
            success: function (rs) {
                var dataGrid = $("#LS_ChuyenLop").dxDataGrid({
                    dataSource: rs,
                    allowColumnReordering: true,
                    allowColumnResizing: true,
                    columnAutoWidth: true,
                    columnFixing: {
                        enabled: true
                    },
                    paging: {
                        pageSize: 10
                    },
                    pager: {
                        showPageSizeSelector: true,
                        allowedPageSizes: [5, 10, 20],
                        showInfo: true
                    },
                    selection: {
                        mode: 'single'
                    },
                    showColumnLines: true,
                    showRowLines: true,
                    filterRow: {
                        visible: true,
                        applyFilter: "auto"
                    },
                    columns: [{
                        caption: "Ngày",
                        dataField: "NGAYBATDAUHOC",
                        alignment: "right",
                    }, {
                        dataField: "",
                        caption: "Người thực hiện",
                    }, {
                        caption: "Trung tâm chuyển đến",
                        dataField: "TRUNGTAMCHUYENDEN",
                    }, {
                        dataField: "TENLOPCHUYENDEN",
                        caption: "Lớp học",
                    }, {
                        dataField: "CHUONGTRINH",
                        caption: "Chương trình",
                    }, {
                        dataField: "NGAYCHUYEN",
                        caption: "Ngày chuyển",
                        alignment: "right",
                    }, {
                        dataField: "NGAYCHUYEN",
                        caption: "Ngày bắt đầu học",
                        alignment: "right",
                    }],
                }).dxDataGrid('instance');
            },
            error: function (a, b, c) {
                DevExpress.ui.notify('Error ' + a.status + ': ' + a.statusText, 'error', 2000);
            }
        });
    }
    function Load_TamDung(hocvien) {
        $.ajax({
            url: '@Url.Action("LoadLichSuTamDung", "HoSoHocVien")',
            type: 'GET',
            data: { HocVien: hocvien },
            contentType: 'application/json',
            success: function (rs) {
                var dataGrid = $("#LS_TamDung").dxDataGrid({
                    dataSource: rs,
                    allowColumnReordering: true,
                    allowColumnResizing: true,
                    columnAutoWidth: true,
                    columnFixing: {
                        enabled: true
                    },
                    paging: {
                        pageSize: 10
                    },
                    pager: {
                        showPageSizeSelector: true,
                        allowedPageSizes: [5, 10, 20],
                        showInfo: true
                    },
                    selection: {
                        mode: 'single'
                    },
                    showColumnLines: true,
                    showRowLines: true,
                    filterRow: {
                        visible: true,
                        applyFilter: "auto"
                    },
                    columns: [{
                        caption: "Ngày",
                        dataField: "NGAYTAMDUNG",
                        alignment: "right",
                    }, {
                        dataField: "NGUOITHUCHIEN",
                        caption: "Người thực hiện",
                    }, {
                        dataField: "NGAYTAMDUNG",
                        caption: "Ngày bắt đầu tạm dừng",
                        alignment: "right",
                    }, {
                        dataField: "NGAYKETTHUCTAMDUNG",
                        caption: "Ngày kết thúc tạm dừng",
                        alignment: "right",
                    }
                    //, {
                    //    dataField: "GHICHU",
                    //    caption: "Lý do",
                    //}
                    ],
                }).dxDataGrid('instance');
            },
            error: function (a, b, c) {
                DevExpress.ui.notify('Error ' + a.status + ': ' + a.statusText, 'error', 2000);
            }
        });
    }
</script>
<script>
    var tinh, tt, idkhachhang;
    $(document).ready(function () {
        $("#NgaySinh").dxDateBox({
            value: '@{ViewContext.Writer.Write(Model.NGAYSINH != null ? Model.NGAYSINH.Value.ToString("yyyy-MM-dd") : "");}',
            formatString: 'dd/MM/yyyy',
            onValueChanged: function (data) {
            },
        }).dxDateBox("instance");
        loadtrungtam();
        loadtinh();
        loadquanhuyen(0);
        loadsale(0);
        loadcm(0);
        loadloaihocsinh();
        loadgioitinh();
        $.ajax({
            url: '@Url.Action("GetMaHocVienAuto", "HoSoHocVien")',
            data: { KhachHang: $('#A_HOSOKHACHHANG').val() },
            success: function (rs) {
                $('#MAKH').val(rs);
            }
        })
        SetValueTT();
        if ($('#A_HOSOKHACHHANG').val() > 0) {
            Load_LSGiaoDich($('#A_HOSOKHACHHANG').val());
            Load_LSThuHocPhi($('#A_HOSOKHACHHANG').val());
            Load_LSBaoLuu($('#A_HOSOKHACHHANG').val());
            Load_LSDangKy($('#A_HOSOKHACHHANG').val());
            Load_XepLop($('#A_HOSOKHACHHANG').val());
            Load_ChuyenPhi($('#A_HOSOKHACHHANG').val());
            Load_ChuyenLop($('#A_HOSOKHACHHANG').val());
            Load_TamDung($('#A_HOSOKHACHHANG').val());
        } else {
            $('#tab_cskh').hide(); $('#tab_dkh').hide();
            $('#tab_xl').hide(); $('#tab_bl').hide();
            $('#tab_cp').hide(); $('#tab_cl').hide();
            $('#tab_td').hide(); $('#tab_tp').hide();
        }
    });
    function SetValueTT() {
        $.ajax({
            url: '@Url.Action("GetTrungTamTheoTaiKhoan", "HoSoHocVien")',
            success: function (rs) {
                if (rs.length == 1) {
                    tt = rs[0].ID_TRUNGTAM;
                    $('#TrungTam').dxSelectBox('instance').option('value', rs[0].ID_TRUNGTAM);
                    loadsale(rs[0].ID_TRUNGTAM);
                    loadcm(rs[0].ID_TRUNGTAM);
                }
            }
        });
    }
    function loadtrungtam() {
        $.getJSON('@Url.Action("GetTrungTamTheoTaiKhoan", "HoSoHocVien")', function (items) {
            $("#TrungTam").dxSelectBox({
                items: items,
                showPopupTitle: false,
                displayExpr: "TENTRUNGTAM",
                valueExpr: "ID_TRUNGTAM",
                searchEnabled: true,
                value: Number('@Model.ID_TRUNGTAM'),
                onValueChanged: function (e) {
                    tt = e.value;
                    loadsale(e.value);
                    loadcm(e.value);
                },
            });
        });
    }
    function loadsale(trungtam) {
        $.ajax({
            url: '@Url.Action("GetNhanSuTheoTrungTamSale", "HoSoHocVien")',
            data: { TrungTam: Number(trungtam) },
            success: function (rs) {
                $("#SalePhuTrach").dxSelectBox({
                    items: rs,
                    showPopupTitle: false,
                    displayExpr: "TENDTTC",
                    valueExpr: "MADTTC",
                    searchEnabled: true,
                    value: '@Model.J_SALE_MAN',
                    onValueChanged: function (e) {
                    },
                });
                if ($('#A_HOSOKHACHHANG').val() == 0) {
                    $('#CMPhuTrach').dxSelectBox('instance').option("disabled", false);
                    $.ajax({
                        url: '@Url.Action("GetECTheoTaiKhoan", "HoSoHocVien")',
                        success: function (rs) {
                            if (rs != null) {
                                $('#SalePhuTrach').dxSelectBox('instance').option('value', rs.MADTTC);
                            } else {
                                $('#SalePhuTrach').dxSelectBox('instance').option('value', '');
                            }
                        }
                    })
                } else {
                    $.ajax({
                        url: '@Url.Action("GetECTheoTaiKhoan", "HoSoHocVien")?tk=' + '@Model.J_SALE_MAN',
                        success: function (rs) {
                            if (rs != null) {
                                $('#SalePhuTrach').dxSelectBox('instance').option('value', rs.MADTTC);
                                if ($('#ChucVuTK').val() >=186 || $('#ChucVuTK').val()==181) {
                                    $('#SalePhuTrach').dxSelectBox('instance').option("disabled", false);
                                } else {
                                    $('#SalePhuTrach').dxSelectBox('instance').option("disabled", true);
                                }
                            } else {
                                $('#SalePhuTrach').dxSelectBox('instance').option("disabled", true);
                            }
                        }
                    })
                }
            }
        });
    }
    function loadcm(trungtam) {
        $.ajax({
            url: '@Url.Action("GetNhanSuTheoTrungTamCM", "HoSoHocVien")',
            data: { TrungTam: Number(trungtam) },
            success: function (rs) {
                $("#CMPhuTrach").dxSelectBox({
                    items: rs,
                    showPopupTitle: false,
                    displayExpr: "TENDTTC",
                    valueExpr: "MADTTC",
                    searchEnabled: true,
                    value: '@Model.J_CSO',
                    onValueChanged: function (e) {
                    },
                });
                if ($('#A_HOSOKHACHHANG').val() == 0) {
                    $('#SalePhuTrach').dxSelectBox('instance').option("disabled", false);
                    $.ajax({
                        url: '@Url.Action("GetCMTheoTaiKhoan", "HoSoHocVien")',
                        success: function (rs) {
                            if (rs != null) {
                                $('#CMPhuTrach').dxSelectBox('instance').option('value', rs.MADTTC);
                            } else {
                                $('#CMPhuTrach').dxSelectBox('instance').option('value', '');
                            }
                        }
                    })
                } else {
                    $.ajax({
                        url: '@Url.Action("GetCMTheoTaiKhoan", "HoSoHocVien")?tk=' + '@Model.J_CSO',
                        success: function (rs) {
                            if (rs != null) {
                                $('#CMPhuTrach').dxSelectBox('instance').option('value', rs.MADTTC);
                                if ($('#ChucVuTK').val() == 185) {
                                    $('#CMPhuTrach').dxSelectBox('instance').option("disabled", false);
                                } else {
                                    $('#CMPhuTrach').dxSelectBox('instance').option("disabled", true);
                                }
                            } else {
                                $('#CMPhuTrach').dxSelectBox('instance').option("disabled", true);
                            }
                        }
                    })
                }
            }
        });
    }
    function loadtinh() {
        $.getJSON('@Url.Action("DM_TinhThanhPho", "DanhMuc")', function (items) {
            $("#TinhThanh").dxSelectBox({
                items: items,
                showPopupTitle: false,
                displayExpr: "TENTINHTHANHPHO",
                valueExpr: "ID_TINHTHANHPHO",
                searchEnabled: true,
                value: Number('@Model.ID_TINHTHANHPHO'),
                onValueChanged: function (e) {
                    tinh = e.value;
                    loadquanhuyen(e.value);
                },
            });
        });
    }
    function loadquanhuyen(tinh) {
        $.ajax({
            url: '@Url.Action("DM_QuanHuyen", "DanhMuc")',
            data: { Tinh: Number(tinh) },
            success: function (rs) {
                $("#QuanHuyen").dxSelectBox({
                    items: rs,
                    showPopupTitle: false,
                    displayExpr: "TENQUANHUYEN",
                    valueExpr: "ID_QUANHUYEN",
                    searchEnabled: true,
                    value: Number('@Model.ID_QUANHUYEN'),
                    onValueChanged: function (e) {
                    },
                });
                if ($('#A_HOSOKHACHHANG').val() == 0) {
                    $('#QuanHuyen').dxSelectBox('instance').option('value', null);
                }
            }
        });
    }
    function loadloaihocsinh() {
        $.getJSON('@Url.Action("DM_LOAIKHACHHANG", "DanhMuc")', function (items) {
            $("#ID_LOAIHOSOKH").dxSelectBox({
                items: items,
                showPopupTitle: false,
                displayExpr: "TENLOAIKHACHHANG",
                valueExpr: "ID_LOAIKHACHHANG",
                searchEnabled: true,
                value: Number('@Model.ID_LOAIHOSOKH'),
                onValueChanged: function (e) {
                },
            });
            if ($('#A_HOSOKHACHHANG').val() == 0) {
                $('#ID_LOAIHOSOKH').dxSelectBox('instance').option('value', 28043);
            }
        });
    }
    function loadgioitinh() {
        $.getJSON('@Url.Action("DM_GIOITINH", "DanhMuc")', function (items) {
            $("#ID_GIOITINH").dxSelectBox({
                items: items,
                showPopupTitle: false,
                displayExpr: "TENGIOITINH",
                valueExpr: "ID_GIOITINH",
                searchEnabled: true,
                value: Number('@Model.ID_GIOITINH'),
                onValueChanged: function (e) {
                },
            });
        });
    }
    function ThemMoi2() {
        $('#A_HOSOKHACHHANG').val(0);
        $.ajax({
            url: '@Url.Action("GetMaHocVienAuto", "HoSoHocVien")',
            data: { KhachHang: 0 },
            success: function (rs) {
                $('#MAKH').val(rs);
            }
        })
        $('#MaEffect').val('');
        $('#TENTIENGANH').val('');
        $('#MaLMS').val('');
        $('#TENKHACHHANG').val('');
        $("#NgaySinh").dxDateBox('instance').option('value', null);
        $('#DIACHI').val('');
        $('#QuanHuyen').dxSelectBox('instance').option('value', null);
        $('#TinhThanh').dxSelectBox('instance').option('value', null);
        $('#ID_GIOITINH').dxSelectBox('instance').option('value', null);
        $('#DIENTHOAI1').val('');
        $('#EMAIL').val('');
        $('#MA_CH').val('');
        $('#TENME').val('');
        $('#DD_ME').val('');
        $('#EmailMe').val('');
        $('#TENBO').val('');
        $('#DD_BO').val('');
        $('#EmailBo').val('');
        $('#ID_LOAIHOSOKH').dxSelectBox('instance').option('value', null);
        $('#SalePhuTrach').dxSelectBox('instance').option('value', null);
        $('#CMPhuTrach').dxSelectBox('instance').option('value', null);
        $('#TrungTam').dxSelectBox('instance').option('value', null);

        loadsale(-1);
        loadcm(-1);
        SetValueTT();
        if ($('#A_HOSOKHACHHANG').val() == 0) {
            $('#ID_LOAIHOSOKH').dxSelectBox('instance').option('value', 28043);
        }
    }
    function DangKy() {

        self.location = '@Url.Action("ChiTietDangKyLop", "DangKyLop")?HocVien=' + ($('#A_HOSOKHACHHANG').val() == 0 ? idkhachhang : $('#A_HOSOKHACHHANG').val());
    }
    function Save() {
        if ($('#TENKHACHHANG').val() == "") {
            $('#lbl_ten').show();
        } else {
            $('#lbl_ten').hide();
        }
        if ($("#NgaySinh").dxDateBox('instance').option('value') == "") {
            $('#lbl_ngaysinh').show();
        } else {
            $('#lbl_ngaysinh').hide();
        }
        if ($('#DIACHI').val() == "") {
            $('#lbl_diachi').show();
        } else {
            $('#lbl_diachi').hide();
        }
        if ($('#TENBO').val() == "") {
            $('#lbl_tenbo').show();
        } else {
            $('#lbl_tenbo').hide();
        }
        if ($('#DD_BO').val() == "") {
            $('#lbl_ddbo').show();
        } else {
            $('#lbl_ddbo').hide();
        }
        if ($('#TENKHACHHANG').val() == '' || $("#NgaySinh").dxDateBox('instance').option('value') == ''
                        || $('#DIACHI').val() == '' || $('#TENBO').val() == '' || $('#DD_BO').val() == '') {
            //DevExpress.ui.notify('Các thông tin có dấu (*) bắt buộc phải nhập', 'warning', 2000);
        } else {
            var result = DevExpress.ui.dialog.confirm('Bạn có muốn lưu kết quả không?', "Xác nhận thay đổi");
            result.done(function (dialogResult) {
                if (dialogResult) {
                    var GioiTinh;
                    if ($('#ID_GIOITINH').is(":checked")) {
                        GioiTinh = 1;
                    }
                    else {
                        GioiTinh = 0;
                    }
                    $.ajax({
                        url: '@Url.Action("KiemTraCheckTrung", "HoSoHocVien")',
                        data: { SoDienThoai: $('#DD_BO').val(), TenHocVien: $('#TENKHACHHANG').val() },
                        success: function (rs) {
                            if ((rs[0].CheckTrung == null && $('#A_HOSOKHACHHANG').val() == 0) || (rs.length == 1 && $('#A_HOSOKHACHHANG').val() != 0)) {
                                $.ajax({
                                    url: '@Url.Action("SaveHocVien", "HoSoHocVien")',
                                    data: JSON.stringify({
                                        khachhang: {
                                            A_HOSOKHACHHANG: $('#A_HOSOKHACHHANG').val(), MAKH: $('#MAKH').val(), C_makh: $('#MaEffect').val(), ma_lms: $('#MaLMS').val(),
                                            TENKHACHHANG: $('#TENKHACHHANG').val(), NGAYSINH: Globalize.format($("#NgaySinh").dxDateBox('instance').option('value'), 'yyyy-MM-dd'),
                                            DIACHI: $('#DIACHI').val(), ID_QUANHUYEN: $('#QuanHuyen').dxSelectBox('instance').option('value'), ID_TINHTHANHPHO: $('#TinhThanh').dxSelectBox('instance').option('value'),
                                            ID_GIOITINH: $('#ID_GIOITINH').dxSelectBox('instance').option('value'), DIENTHOAI1: $('#DIENTHOAI1').val(), EMAIL: $('#EMAIL').val(), MA_CH: $('#MA_CH').val(),
                                            TENME: $('#TENME').val(), DD_ME: $('#DD_ME').val(), EMAIL_ME: $('#EmailMe').val(), TENBO: $('#TENBO').val(),
                                            DD_BO: $('#DD_BO').val(), EMAIL_BO: $('#EmailBo').val(), ID_LOAIHOSOKH: $('#ID_LOAIHOSOKH').dxSelectBox('instance').option('value'),
                                            J_SALE_MAN: $('#SalePhuTrach').dxSelectBox('instance').option('value'), J_CSO: $('#CMPhuTrach').dxSelectBox('instance').option('value'),
                                            ID_TRUNGTAM: $('#TrungTam').dxSelectBox('instance').option('value'), SOCMTND: $('#SOCMTND').val(),TENTIENGANH:$('#TENTIENGANH').val()
                                        }
                                    }),
                                    type: 'POST',
                                    contentType: 'application/json; charset=utf-8',
                                    success: function (data) {

                                        idkhachhang = data;
                                        DevExpress.ui.notify('Cập nhật thành công', 'success', 2000);
                                        bootBox.modal('hide');
                                        LoadDanhSachHocVien();
                                        //document.querySelector('.dx-toast-success').style.transform = "translate(720px, 30px)";
                                        //window.opener.location.reload(true);
                                    }
                                })
                            }
                            else {
                                DevExpress.ui.notify('Học sinh đã tồn tại trong hệ thống! Vui lòng kiểm tra lại.', 'warning', 2000);
                            }
                        }
                    })
                }
                else {
                }
            });
        }
    }
    function LoadDanhSachHocVien() {
        $.ajax({
            url: '@Url.Action("GetHoSoHocVien", "HoSoHocVien")',
            type: 'GET',
            contentType: 'application/json',
            success: function (rs) {
                var dataGrid = $("#gridDanhSachHocVien").dxDataGrid({
                    dataSource: rs,
                    allowColumnReordering: false,
                    allowColumnResizing: false,
                    columnAutoWidth: false,
                    columnFixing: {
                        enabled: true
                    },
                    paging: {
                        pageSize: 10
                    },
                    pager: {
                        showPageSizeSelector: true,
                        allowedPageSizes: [10, 20, 50],
                        showInfo: true
                    },
                    showColumnLines: true,
                    showRowLines: true,
                    filterRow: {
                        visible: true,
                        applyFilter: "auto"
                    },
                    selection: {
                        mode: "single"
                    },
                    columns: [{
                            dataField: "STT",
                            caption: "STT",
                            width: 50
                        },{
                              dataField: "MAHOCSINH",
                              caption: "Mã học sinh",
                              width: 150,

                          }, {
                              caption: "Mã Effect",
                              dataField: "ma_effect",
                              width: 120,

                          }, {
                              caption: "Mã LMS",
                              dataField: "ma_lms",
                              width: 120,

                          }, {
                              dataField: "tenhocsinh",
                              caption: "Tên học sinh",
                              width: 200,
                          }, {
                              dataField: "TENTRUNGTAM",
                              caption: "Trung tâm",
                              width: 200,
                          }, {
                              caption: "Loại khách hàng",
                              dataField: "LOAIHOCSINh",
                              width: 120,

                          }, {
                              caption: "EC",
                              dataField: "saleman",
                              width: 200,
                          },
                          {
                              caption: "CM phụ trách",
                              dataField: "CM",
                              width: 200,
                          }, {
                              caption: "Phụ huynh 1",
                              dataField: "TENBO",
                              width: 200,
                          }, {
                              dataField: "DIACHI",
                              caption: "Địa chỉ",
                              width: 200,
                          }, {
                              caption: "Email",
                              dataField: "EMAIL",
                              width: 120,
                          }, {
                              caption: "Điện thoại",
                              dataField: "dienthoai",
                              width: 120,
                          }, {
                              caption: "Số CMTND",
                              dataField: "SOCMTND",
                              width: 120,
                          },
                    ],
                    onCellClick: function (e) {
                        var component = e.component,
                            prevClickTime = component.lastClickTime;
                        component.lastClickTime = new Date();
                        if (prevClickTime && (component.lastClickTime - prevClickTime < 300)) {
                            var dataGrid2 = $('#gridDanhSachHocVien').dxDataGrid('instance');
                            var row = dataGrid2.getSelectedRowsData();
                            $('#iconMoCT').css({ top: -41, left: -12 }).removeClass("fa-floppy-o").addClass('fa-spinner fa-pulse fa-fw');
                            $('#spaniconMoCT').removeClass('hidden'); $('#spanMoCT').addClass('hidden');
                            $.when(
                                $.ajax({
                                    method: 'GET',
                                    url: '/HoSoHocVien/ChiTietHocVien',
                                    data: { HoSoKhachHang: row[0].A_HOSOKHACHHANG },
                                    dataType: 'html',
                                    success: function (data) {
                                        bootBox = bootbox.dialog({
                                            size: 'large',
                                            title: 'Thông tin chi tiết hồ sơ học sinh',
                                            message: data
                                        });
                                    }
                                })
                            ).done(function () {
                                setTimeout(function () {
                                }, 500);
                                $('#iconMoCT').removeAttr('style').removeClass('fa-spinner fa-pulse fa-fw').addClass("fa-floppy-o");
                                $('#spaniconMoCT').addClass('hidden'); $('#spanMoCT').closest('hidden');
                            });
                        }
                        else {
                            ss = [];
                        }
                    }

                }).dxDataGrid('instance');
            },
            error: function (a, b, c) {
                DevExpress.ui.notify('Error ' + a.status + ': ' + a.statusText, 'error', 2000);
            }

        });
    }
</script>