
@{
    ViewBag.Title = "ChiTietTiepNhan";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<input type="hidden" value="@ViewBag.HocVien" id="HocVien" />
<input type="hidden" value="@ViewBag.LopHoc" id="LopHoc" />
<div class="box box-danger">
    <div class="box-header with-border">
        <h3 class="box-title">Đăng ký tiếp nhận</h3>
    </div>
    <!-- /.box-header -->
    <!-- form start -->
    <form class="form-horizontal">
        <!--Menu-->
        <!--Menu-->
        <div class="margin text-right">
            <div class="btn-group"><button type="button" class="btn btn-block btn-danger" onclick="DuyetTiepNhanChuyenLop()">Duyệt</button></div>
            <div class="btn-group"><button type="button" class="btn btn-block btn-danger" id="btnLuuTiepNhan" onclick="Luu()">Cập nhật</button></div>
        </div>
        <!--/Menu-->
        <!--/Menu-->
        <div class="box-body">
            <div class="col-md-6">
                @*<div class="form-group">
                    <label class="col-sm-3 control-label">Tìm học viên</label>
                    <div class="col-sm-9">
                        <div class="input-group">
                            <input type="text" class="form-control" id="TIMKIEMHOCVIEN">
                            <span class="input-group-btn">
                                <button type="button" class="btn btn-block btn-danger" onclick="TimKiemHocSinh()">Tìm kiếm</button>
                            </span>
                        </div>
                    </div>
                </div>*@
                <div class="form-group">
                    <label class="col-sm-3 control-label">Tên học viên</label>
                    <div class="col-sm-9">
                        <input type="text" class="form-control" readonly id="TenHocVien" placeholder="">
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Số điện thoại</label>
                    <div class="col-sm-9">
                        <input type="text" class="form-control" readonly id="SDT" placeholder="">
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-group">
                    <label class="col-sm-3 control-label"></label>

                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Email</label>
                    <div class="col-sm-9">
                        <input type="text" class="form-control" readonly id="Email" placeholder="">
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Địa chỉ</label>
                    <div class="col-sm-9">
                        <input type="text" class="form-control" readonly id="DiaChi" placeholder="">
                    </div>
                </div>
            </div>
        </div>
        <!-- /.box-body -->
        <div class="box-body">
            <div class="col-md-6">
                <div class="form-group">
                    <h5><label class="col-sm-12 control-label text-bold" style="text-align:left">THÔNG TIN HỌC LỚP ĐANG HỌC</label></h5>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Tên lớp</label>
                    <div class="col-sm-9">
                        <input type="text" class="form-control" readonly id="TenLop" placeholder="">
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Trung tâm</label>
                    <div class="col-sm-9">
                        <input type="text" class="form-control" readonly id="TrungTam" placeholder="">
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Chương trình</label>
                    <div class="col-sm-9">
                        <input type="text" class="form-control" readonly id="ChuongTrinh" placeholder="">
                    </div>
                </div>
                @*<div class="form-group">
                    <label class="col-sm-3 control-label" style="padding:7px 0px!important">Ngày chuyển</label>
                    <div class="col-sm-6">
                        <div id="NgayChuyen" style="width:100%"></div>
                    </div>
                </div>*@
                <div class="form-group" style="margin-bottom: 0px;">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="col-sm-6 control-label">Buổi 1</label>
                            <div class="col-sm-6">
                                <input type="text" id="Buoi1" readonly class="form-control">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="col-sm-5 control-label" style="padding-right: 0px!important">Buổi 2</label>
                            <div class="col-sm-7">
                                <input type="text" id="Buoi2" readonly class="form-control">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group" style="margin-bottom: 0px;">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="col-sm-6 control-label">Số buổi</label>
                            <div class="col-sm-6">
                                <input type="text" id="SoBuoi" readonly class="form-control">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="col-sm-5 control-label" style="padding-right: 0px!important">Số buổi còn lại</label>
                            <div class="col-sm-7">
                                <input type="text" id="SoBuoiConLai" readonly class="form-control">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group" style="margin-bottom: 0px;">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="col-sm-6 control-label">Đơn giá</label>
                            <div class="col-sm-6">
                                <input type="text" id="DonGia" readonly class="form-control">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="col-sm-5 control-label" style="padding-right: 0px!important">Thành tiền còn lại</label>
                            <div class="col-sm-7">
                                <input type="text" id="ThanhTienConLai" readonly class="form-control">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group" style="margin-bottom: 0px;">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="col-sm-6 control-label">Ngày bắt đầu</label>
                            <div class="col-sm-6">
                                <input type="text" id="NgayBatDau" readonly class="form-control">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="col-sm-5 control-label" style="padding-right: 0px!important">Ngày học cuối</label>
                            <div class="col-sm-7">
                                <input type="text" id="NgayKetThuc" readonly class="form-control">
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <div class="col-md-6">
                <div class="form-group">
                    <h5><label class="col-sm-12 control-label text-bold" style="text-align:left">THÔNG TIN LỚP CHUYỂN ĐẾN</label></h5>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Lớp học</label>
                    <div class="col-sm-9">
                        <div class="input-group">
                            <input type="text" readonly class="form-control" id="TIMKIEMLOPHOC">
                            <span class="input-group-btn">
                                <button type="button" class="btn btn-block btn-danger" onclick="TimKiemLop()">Tìm kiếm</button>
                            </span>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Chương trình</label>
                    <div class="col-sm-9">
                        <input type="text" class="form-control" readonly id="ChuongTrinhLopChuyenDen" placeholder="">
                    </div>
                </div>
                <div class="form-group" style="margin-bottom: 0px;">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="col-sm-6 control-label">Buổi 1</label>
                            <div class="col-sm-6">
                                <input type="text" id="Buoi1LopChuyenDen" readonly class="form-control">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="col-sm-5 control-label" style="padding-right: 0px!important">Buổi 2</label>
                            <div class="col-sm-7">
                                <input type="text" id="Buoi2LopChuyenDen" readonly class="form-control">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group" style="margin-bottom: 0px;">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="col-sm-6 control-label">Số buổi nhận</label>
                            <div class="col-sm-6">
                                <input type="text" id="SoBuoiNhanLopChuyenDen" readonly class="form-control">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">

                    </div>
                </div>
                <div class="form-group" style="margin-bottom: 0px;">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="col-sm-6 control-label">Đơn giá</label>
                            <div class="col-sm-6">
                                <input type="text" id="DonGiaLopChuyenDen" readonly class="form-control">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="col-sm-5 control-label" style="padding-right: 0px!important">Thành tiền</label>
                            <div class="col-sm-7">
                                <input type="text" id="ThanhTienLopChuyenDen" readonly class="form-control">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group" style="margin-bottom: 0px;">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="col-sm-6 control-label">Ngày bắt đầu</label>
                            <div class="col-sm-6">
                                <div id="NgayBatDauLopChuyenDen" style="width:115px"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="col-sm-5 control-label" style="padding-right: 0px!important">Ngày học cuối</label>
                            <div class="col-sm-7">
                                <div id="NgayKetThucLopChuyenDen" style="width:135px"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>
<div class="modal fade" id="TimHocVien" style="display: none;">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-red">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
                <h4 class="modal-title">Danh sách học viên đã xếp lớp</h4>
            </div>
            <div class="modal-body">
                <div id="gridDanhSachHocSinhDaXepLop">
                </div>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
<!-- /.box -->
<div class="modal fade" id="TimLopHoc" style="display: none;">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-red">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
                <h4 class="modal-title">Danh sách lớp học</h4>
            </div>
            <div class="modal-body">
                <div id="gridDanhSachHocLopHoc">
                </div>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
<div class="modal fade" id="DuyetTiepNhan" style="display: none;">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-red">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
                <h4 class="modal-title">Duyệt thực hiện</h4>
            </div>
            <div class="modal-body">
                <div class="box-body">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="col-sm-4 control-label">Tên người dùng</label>
                            <div class="col-sm-8">
                                <input type="text" id="TenNguoiDung" readonly class="form-control">
                            </div>
                        </div>
                        <div class="form-group" style="margin-top:40px;">
                            <label class="col-sm-4 control-label" style="padding-left:0px">Nội dung/Ghi chú</label>
                            <div class="col-sm-8">
                                <textarea class="form-control" rows="3" id="GhiChuDuyet" placeholder="Nội dung ..."></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="col-sm-4 control-label">ý kiến duyệt<span style="color:red">*</span></label>
                            <div class="col-sm-8">
                                <div id="YKienDuyet" style="width:100%"></div>
                            </div>
                        </div>
                        <div class="form-group" style="margin-top:40px;">
                            <div class="col-sm-8">
                                <button id="LuuDuyet" style="width:90px;height:90px;border-radius:10px;border-color:red" onclick="LuuDuyetTiepNhanChuyenLop()" class="btn-danger">Duyệt</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="gridDanhSachLichSuDuyet">
                </div>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
<script>
    var sobuoiconlai = 0, buoi1 = 0, buoi2 = 0, a_thdubao=0, a_hosokhachhang, a_kehoach, a_sanpham, id_trungtam, id_trungtamhocvien, a_sanphamhocvien, khuvuc = 0, id_buoi1 = 0, id_buoi2 = 0, id_khuvuc=0;
    $(document).ready(function () {
        $("#NgayKetThucLopChuyenDen").dxDateBox({
            formatString: 'dd/MM/yyyy',
            onValueChanged: function (data) {
            },
        }).dxDateBox("instance");
        if ($('#HocVien').val() != null && $('#LopHoc').val()!=null)
        {
            $.ajax({
                url: '@Url.Action("GETDANHSACHCHUYENLOPTUTTKHAC", "TiepNhanChuyenLop")',
                type: 'GET',
                data: { HocVien: $('#HocVien').val(), LopHoc: $('#LopHoc').val() },
                contentType: 'application/json',
                success: function (rs) {
                    if (rs.length > 0) {
                        if (rs[0].ID_DUYET > 0) {
                            $("#btnLuuTiepNhan").prop("disabled", true);
                        }
                        else {
                            $("#btnLuuTiepNhan").prop("disabled", false);
                        }
                        khuvuc = rs[0].ID_KHUVUC;
                        $('#TenHocVien').val(rs[0].TenHocVien);
                        $('#SDT').val(rs[0].DIENTHOAI1);
                        $('#TenLop').val(rs[0].TenLop);
                        $('#TrungTam').val(rs[0].TrungTam);
                        $('#ChuongTrinh').val(rs[0].ChuongTrinh);
                        $('#Buoi1').val(rs[0].Buoi1);
                        $('#Buoi2').val(rs[0].Buoi2);
                        $('#SoBuoi').val(rs[0].SobuoiHoc);
                        $('#SoBuoiConLai').val(Number(rs[0].SOBUOI));
                        //sobuoiconlai = Number(rs[0].SobuoiHoc) - Number(rs[0].SOBUOIDAHOC);
                        $('#DonGia').val(rs[0].DonGia);
                        $('#ThanhTienConLai').val(Number(rs[0].DonGia) * Number(rs[0].SOBUOI));
                        $('#NgayBatDau').val(rs[0].NGAYDUKIENHOC);
                        $('#NgayKetThuc').val(rs[0].NGAYKETHUCHOC);
                        $('#Email').val(rs[0].EMAIL);
                        $('#DiaChi').val(rs[0].DiaChi);
                        sobuoiconlai = Number(rs[0].SOBUOI);
                        a_thdubao = rs[0].A_TH_DUBAO;
                        a_hosokhachhang = rs[0].A_HOSOKHACHHANG;
                        a_kehoach = rs[0].A_KEHOACH;
                        id_trungtamhocvien = rs[0].ID_TRUNGTAM == null ? 0 : rs[0].ID_TRUNGTAM;
                        a_sanphamhocvien = rs[0].A_SANPHAM == null ? 0 : rs[0].A_SANPHAM;
                        id_buoi1 = rs[0].ID_PHUONGTHUC;
                        id_buoi2 = rs[0].ID_CONGCU;
                        $('#SoBuoiNhanLopChuyenDen').val(rs[0].SOBUOI);
                        $("#ThanhTienLopChuyenDen").val((Number(rs[0].DonGia) * Number(rs[0].SOBUOI)).toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,"));
                    }
                }
            })
        }
        $("#NgayBatDauLopChuyenDen").dxDateBox({
            formatString: 'dd/MM/yyyy',
            onChange: function (data) {
                var dateBox = $("#NgayBatDauLopChuyenDen").dxDateBox("instance");
                var dateBoxValue = dateBox.option('text');
                $("#NgayBatDauLopChuyenDen").dxDateBox('instance').option('value', ConvertDate(dateBoxValue));
            },
            onValueChanged: function (data) {
                ngaybatdaulopchuyenden = Globalize.format(data.value, 'yyyy-MM-dd');
                $.ajax({
                    url: '@Url.Action("LayNGayKetThucHoanChinh", "DangKyBaoLuu")',
                    data: { ngaybd: ngaybatdaulopchuyenden, SoBuoi: sobuoiconlai, Buoi1: buoi1, Buoi2: buoi2, KhuVuc: id_khuvuc },
                    type: 'GET',
                    contentType: 'application/json',
                    success: function (rs) {
                        var kq = rs.split("/")[1] + "/" + rs.split("/")[0] + "/" + rs.split("/")[2];
                        $("#NgayKetThucLopChuyenDen").dxDateBox('instance').option('value', kq);
                    }
                })
            },
        }).dxDateBox("instance");
        LoadDanhMucDuyet();
        LoadDanhSachHocVien(a_thdubao);
    })
    function ConvertDate(obj) {
        var d = new Date(obj.split("/").reverse().join("-"));
        var dd = d.getDate();
        var mm = d.getMonth() + 1;
        var yy = d.getFullYear();
        return mm + "/" + dd + "/" + yy;
    }
    function TimKiemLop() {
        $('#TimLopHoc').modal('show');
        LoadDanhSachLop();
    }
    function LoadDanhMucDuyet() {
        $.ajax({
            url: '@Url.Action("DM_DuyetThucHien", "DanhMuc")',
            type: 'GET',
            contentType: 'application/json',
            success: function (rs) {
                $("#YKienDuyet").dxSelectBox({
                    items: rs,
                    showPopupTitle: false,
                    displayExpr: "TENDUYET",
                    valueExpr: "ID_DUYET",
                    searchEnabled: true,
                    onValueChanged: function (e) {
                        id_duyet = e.value;
                    },
                });
            }
        })
    }
    function LoadDanhSachLopHoc(lophoc) {
        $('#TimLopHoc').modal('hide');
        $.ajax({
            url: '@Url.Action("LoadDanhSachLop", "DangKyChuyenLop")',
            type: 'GET',
            data: { LopHoc: lophoc },
            contentType: 'application/json',
            success: function (rs) {
                if (rs.length > 0) {
                    $('#TIMKIEMLOPHOC').val(rs[0].TENLOP);
                    $('#ChuongTrinhLopChuyenDen').val(rs[0].CHUONGTRINH);
                    $('#Buoi1LopChuyenDen').val(rs[0].BUOI1);
                    $('#Buoi2LopChuyenDen').val(rs[0].BUOI2);
                    //$('#SoBuoiNhanLopChuyenDen').val(Number(sobuoiconlai));
                    $('#DonGiaLopChuyenDen').val(rs[0].DONGIA);
                    //$('#ThanhTienLopChuyenDen').val(Number(rs[0].DONGIA) * Number(sobuoiconlai));
                    buoi1 = rs[0].ID_PHUONGTHUC;
                    buoi2 = rs[0].ID_CONGCU;
                    id_khuvuc = rs[0].ID_KHUVUC;
                    a_sanpham = rs[0].A_SANPHAM == null ? 0 : rs[0].A_SANPHAM;
                    id_trungtam = rs[0].ID_TRUNGTAM == null ? 0 : rs[0].ID_TRUNGTAM;

                }
            }
        })
    }
    function ThemMoi() {
        $('#TenHocVien').val('');
        $('#SDT').val('');
        $('#TenLop').val('');
        $('#TrungTam').val('');
        $('#ChuongTrinh').val('');
        $('#Buoi1').val('');
        $('#Buoi2').val('');
        $('#SoBuoi').val('');
        $('#SoBuoiConLai').val('');
        $('#DonGia').val('');
        $('#ThanhTienConLai').val('');
        $('#NgayBatDau').val('');
        $('#NgayKetThuc').val('');
        $('#Email').val('');
        $('#DiaChi').val('');
        $('#ChuongTrinhLopChuyenDen').val('');
        $('#Buoi1LopChuyenDen').val('');
        $('#Buoi2LopChuyenDen').val('');
        $('#SoBuoiNhanLopChuyenDen').val('');
        $('#DonGiaLopChuyenDen').val('');
        $('#ThanhTienLopChuyenDen').val('');
        $("#NgayKetThucLopChuyenDen").dxDateBox('instance').option('value', null);
        $("#NgayBatDauLopChuyenDen").dxDateBox('instance').option('value', null);
    }
    function Luu() {
        $.ajax({
            url: '@Url.Action("CapNhatDangKyChuyenLopCungTrungTam", "TiepNhanChuyenLop")',
            data: {J_HOSOKHACHHANG: a_hosokhachhang, J_KEHOACH: a_kehoach, NGAYGIAOHANG: Globalize.format($("#NgayKetThucLopChuyenDen").dxDateBox('instance').option('value'), 'yyyy-MM-dd'), TONGTIEN_DH: $('#ThanhTienLopChuyenDen').val(), SOBUOI: $('#SoBuoiNhanLopChuyenDen').val(), DONGIA: $('#DonGiaLopChuyenDen').val(), ID_BOPHAN: id_trungtam, GHICHU: "", J_SANPHAM: a_sanpham, NGAYDUKIENHOC: Globalize.format($("#NgayBatDauLopChuyenDen").dxDateBox('instance').option('value'), 'yyyy-MM-dd') },
            beforeSend: function () { window.parent.$('#loading').show(); },
            success: function (data) {
                window.parent.$("#loading").fadeOut("fast");
                if (!isNaN(data)) {
                    if (data == 1) {
                        $("#btnLuuTiepNhan").prop("disabled", true);
                        DevExpress.ui.notify('Cập nhật thành công', 'success', 2000);
                    }
                }
                else {
                    DevExpress.ui.notify('Chưa cập nhật được', 'error', 2000);
                }
            }
        })
    }
    function LoadDanhSachLop() {
        $.ajax({
            url: '@Url.Action("GetDanhSachLopHoc", "DangKyChuyenLop")',
            type: 'GET',
            data: { TrungTam: $('#TIMKIEMLOPHOC').val() },
            contentType: 'application/json',
            success: function (rs) {
                var dataGrid = $("#gridDanhSachHocLopHoc").dxDataGrid({
                    dataSource: rs,
                    allowColumnReordering: false,
                    allowColumnResizing: false,
                    columnAutoWidth: false,
                    columnFixing: {
                        enabled: true
                    },
                    paging: {
                        pageSize: 10
                    },
                    showColumnLines: true,
                    showRowLines: true,
                    filterRow: {
                        visible: true,
                        applyFilter: "auto"
                    },
                    columns: [
                        {
                            caption: "Chọn", alignment: 'center',
                            width: 100,
                            cellTemplate: function (container, options) {
                                var dt = options.data;
                                $('<a href="javascript:" onclick="LoadDanhSachLopHoc(\'' + dt.A_KEHOACH + '\')"  class="text-green"><b>...</b></a>').appendTo(container);
                            }
                        },
                          {
                              dataField: "TENLOP",
                              caption: "Tên lớp",
                              width: 250,
                          }, {
                              caption: "Mã trung tâm",
                              dataField: "TRUNGTAM",
                              width: 250,
                          }, {
                              caption: "Số buổi",
                              dataField: "SOBUOI",
                              width: 120,
                          }, {
                              dataField: "BUOI1",
                              caption: "Buổi 1",
                              width: 100,
                          },
                           {
                               dataField: "BUOI2",
                               caption: "Buổi 2",
                               width: 100,
                           },
                          {
                              dataField: "NGAYBATDAU",
                              caption: "Ngày bắt đầu",
                              width: 120,
                          }, {
                              dataField: "CHUONGTRINH",
                              caption: "Chương trình",
                              width: 200,
                          },
                          {
                              dataField: "TENNHOMSANPHAM",
                              caption: "Nhóm sản phẩm",
                              width: 120,
                          },
                          {
                              caption: "Đơn giá",
                              dataField: "DONGIA",
                              width: 120,
                          },
                    ],

                }).dxDataGrid('instance');
            },
            error: function (a, b, c) {
                DevExpress.ui.notify('Error ' + a.status + ': ' + a.statusText, 'error', 2000);
            }

        });
    }
    function LoadDanhSachHocVien(obj) {
        $.ajax({
            url: '@Url.Action("GetDanhSachLichSuDuyet", "TiepNhanChuyenLop")',
            type: 'GET',
            data: { DuBao: obj },
            contentType: 'application/json',
            success: function (rs) {
                var dataGrid = $("#gridDanhSachLichSuDuyet").dxDataGrid({
                    dataSource: rs,
                    allowColumnReordering: false,
                    allowColumnResizing: false,
                    columnAutoWidth: false,
                    columnFixing: {
                        enabled: true
                    },
                    paging: {
                        pageSize: 10
                    },
                    showColumnLines: true,
                    showRowLines: true,
                    filterRow: {
                        visible: true,
                        applyFilter: "auto"
                    },
                    columns: [
                        {
                            caption: "Ngày duyệt",
                            dataField: "NGAYDUYET",
                            width: 200,
                        }, {
                            caption: "Người duyệt",
                            dataField: "TENDTTC",
                            width: 200,
                        }, {
                            dataField: "TENDUYET",
                            caption: "Trạng thái",
                            width: 200,
                        },
                        {
                            dataField: "YKIENBOSUNG",
                            caption: "Ý kiến duyệt",
                            width: 200,
                        },
                    ],

                }).dxDataGrid('instance');
            },
            error: function (a, b, c) {
                DevExpress.ui.notify('Error ' + a.status + ': ' + a.statusText, 'error', 2000);
            }

        });
    }
    function LuuDuyetTiepNhanChuyenLop() {
        var formData = new FormData();
        formData.append("A_THDUBAO", a_thdubao);
        formData.append("IDDuyet", $("#YKienDuyet").dxSelectBox('instance').option('value'));
        formData.append("NoiDung", $('#GhiChuDuyet').val());
        var result = DevExpress.ui.dialog.confirm('Bạn có chắc chắn lưu không?', "Confirm changes");
        result.done(function (dialogResult) {
            if (dialogResult) {
                $.ajax({
                    type: "POST",
                    url: '@Url.Action("SaveDuyetChuyenLop", "TiepNhanChuyenLop")',
                    dataType: 'json',
                    contentType: false,
                    processData: false,
                    data: formData,
                    beforeSend: function () { window.parent.$('#loading').show(); },
                    success: function (data) {
                        window.parent.$("#loading").fadeOut("fast");
                        if (data > 0) {
                            $("#btnLuu").prop("disabled", true);
                            DevExpress.ui.notify('Cập nhật thành công', 'success', 2000);
                            LoadDanhSachHocVien(a_thdubao);
                        }
                        else {
                            DevExpress.ui.notify('Chưa cập nhật được', 'error', 2000);
                        }
                    }
                })
            }
        });
    }
    function DuyetTiepNhanChuyenLop() {
        if (a_thdubao > 0) {
            $.getJSON('/TiepNhanChuyenLop/LoadNguoiDung', $.param({ DuBao: a_thdubao }), function (rs) {
                if (rs.TENDTTC == undefined) {
                    $('#TenNguoiDung').val(rs);
                }
                else {
                    $('#TenNguoiDung').val(rs.TENDTTC);
                }
                $('#GhiChuDuyet').val(rs.YKIENBOSUNG);
                $("#YKienDuyet").dxSelectBox('instance').option('value', rs.ID_DUYET);
                if (rs.ID_DUYET > 0) {
                    $("#LuuDuyet").prop("disabled", true);
                }
                else {
                    $("#LuuDuyet").prop("disabled", false);
                }
            })
            LoadDanhSachHocVien(a_thdubao);
            $('#DuyetTiepNhan').modal('show');
        }
        else {
            DevExpress.ui.notify('Chưa chọn học viên để duyệt', 'error', 2000);
            return;
        }
    }
</script>


